
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://polygon.technology/polygon-id/verify-with-zkp-application-level/zk-login-integration/">
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>ZK login integration - Polygon ID Documentation tutorials</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#7e56c2">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="deep-purple" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#zk-login-integration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Polygon ID Documentation tutorials" class="md-header__button md-logo" aria-label="Polygon ID Documentation tutorials" data-md-component="logo">
      
  <img src="../../logo-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Polygon ID Documentation tutorials
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ZK login integration
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../getting-started/getting-started/" class="md-tabs__link">
        Issuer Protocol
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../intro/" class="md-tabs__link md-tabs__link--active">
        Verifier Intergration
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../circuits/main-circuits/" class="md-tabs__link">
        Circuits
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../contracts/overview/" class="md-tabs__link">
        Contracts
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Polygon ID Documentation tutorials" class="md-nav__button md-logo" aria-label="Polygon ID Documentation tutorials" data-md-component="logo">
      
  <img src="../../logo-white.svg" alt="logo">

    </a>
    Polygon ID Documentation tutorials
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Issuer Protocol
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Issuer Protocol" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Issuer Protocol
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/getting-started/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_2">
          Core Components
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Core Components" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Core Components
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/babyjubjub/" class="md-nav__link">
        Baby Jubjub Keypair
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/mt/" class="md-nav__link">
        Sparse Merkle Tree
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_3" type="checkbox" id="__nav_1_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_2_3">
          Claim
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Claim" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_2_3">
          <span class="md-nav__icon md-icon"></span>
          Claim
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/claim/generic-claim/" class="md-nav__link">
        Generic Claim
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/claim/auth-claim/" class="md-nav__link">
        Auth Claim
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/claim/claim-schema/" class="md-nav__link">
        Claim Schema
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2_4" type="checkbox" id="__nav_1_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_2_4">
          Identity
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Identity" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_2_4">
          <span class="md-nav__icon md-icon"></span>
          Identity
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/identity/identity-structure/" class="md-nav__link">
        Identity Structure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/identity/identity-state/" class="md-nav__link">
        Identity State
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/identity/identifier/" class="md-nav__link">
        Identifier
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_3">
          Issue Claim
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Issue Claim" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          Issue Claim
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/issue-claim-overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/signature-claim/signature/" class="md-nav__link">
        via Signature
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3_3" type="checkbox" id="__nav_1_3_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_3_3">
          via Merkle Tree
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="via Merkle Tree" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_3_3">
          <span class="md-nav__icon md-icon"></span>
          via Merkle Tree
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/state-transition/state-transition/" class="md-nav__link">
        Intro to State Transition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/state-transition/new-identity-state/" class="md-nav__link">
        Add Claim to the Claims Tree
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/state-transition/state-transition-proof/" class="md-nav__link">
        Generate Proof for State Transition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/state-transition/on-chain-state-transition/" class="md-nav__link">
        Verify the Proof On-Chain
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Verifier Intergration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Verifier Intergration" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Verifier Intergration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zk-login-workflow/" class="md-nav__link">
        ZK login workflow
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          ZK login integration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        ZK login integration
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#integrate-with-javascript-and-golang" class="md-nav__link">
    Integrate with Javascript and GoLang
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verification-procedure" class="md-nav__link">
    Verification Procedure
  </a>
  
    <nav class="md-nav" aria-label="Verification Procedure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zero-knowledge-proof-verification" class="md-nav__link">
    Zero Knowledge Proof Verification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verification-of-on-chain-identity-states" class="md-nav__link">
    Verification of On-chain Identity States
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verification-of-circuit-public-inputs" class="md-nav__link">
    Verification of Circuit Public Inputs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demo/" class="md-nav__link">
        Demo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../jwz/" class="md-nav__link">
        JWZ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../query-language/" class="md-nav__link">
        Query
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Circuits
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Circuits" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Circuits
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../circuits/main-circuits/" class="md-nav__link">
        Main Circuits
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../circuits/template-circuits/" class="md-nav__link">
        Template Circuits
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Contracts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contracts" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Contracts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contracts/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#integrate-with-javascript-and-golang" class="md-nav__link">
    Integrate with Javascript and GoLang
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verification-procedure" class="md-nav__link">
    Verification Procedure
  </a>
  
    <nav class="md-nav" aria-label="Verification Procedure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zero-knowledge-proof-verification" class="md-nav__link">
    Zero Knowledge Proof Verification
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verification-of-on-chain-identity-states" class="md-nav__link">
    Verification of On-chain Identity States
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verification-of-circuit-public-inputs" class="md-nav__link">
    Verification of Circuit Public Inputs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="zk-login-integration">ZK Login Integration</h1>
<p>The intergation of this workflow inside your application only requires to embed a button to initiate the login process on the front-end. After this button is pressed, the front-end makes a request to the back-end to generate an <code>auth request</code> and displays it in a QR code. When a user scans the QR code using their wallet, it generates a zk proof and sends this proof packed inside a JWZ to the call-back URL in order to verify it. </p>
<p>Overall there are 2 endpoints to be added to the verifier's backend: </p>
<ul>
<li>GET /api/sign-in - should return auth request inside a QR code</li>
<li>POST /api/callback - should receive the callback request from the identity wallet containing the proof and verify it</li>
</ul>
<p>The user should have the Polygon ID identity wallet (or any compatible wallet) installed on their device.</p>
<h2 id="integrate-with-javascript-and-golang">Integrate with Javascript and GoLang</h2>
<blockquote>
<p>Context: You are a platform that wants to authenticate users according to their age. If they are younger than a certain age, users are not allowed to log-in. The naive web2 way to perform this action would be to make users fill up a form with personal information. In web3 we can perform the same never accessing any user's PII.</p>
</blockquote>
<ol>
<li>
<p><strong>Add the authorization package to your project</strong> </p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">GoLang</label><label for="__tabbed_1_2">Javascript</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>go get github.com/iden3/go-iden3-auth
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>npm i @iden3/js-iden3-auth --save
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p><strong>Set up a server</strong> </p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">GoLang</label><label for="__tabbed_2_2">Javascript</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;encoding/json&quot;</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;io&quot;</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;strconv&quot;</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;time&quot;</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;github.com/iden3/go-circuits&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nx">auth</span><span class="w"> </span><span class="s">&quot;github.com/iden3/go-iden3-auth&quot;</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;github.com/iden3/go-iden3-auth/loaders&quot;</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;github.com/iden3/go-iden3-auth/pubsignals&quot;</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;github.com/iden3/go-iden3-auth/state&quot;</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;github.com/iden3/iden3comm/protocol&quot;</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/api/sign-in&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">GetQR</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/api/callback&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Callback</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Create a map to store the auth requests and their session IDs</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">requestMap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{})</span><span class="w"></span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span><span class="w"></span>
<span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="nx">auth</span><span class="p">,</span><span class="w"> </span><span class="nx">resolver</span><span class="p">,</span><span class="w"> </span><span class="nx">loaders</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@iden3/js-iden3-auth&#39;</span><span class="p">)</span><span class="w"></span>
<span class="kd">const</span><span class="w"> </span><span class="nx">getRawBody</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;raw-body&#39;</span><span class="p">)</span><span class="w"></span>

<span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">();</span><span class="w"></span>
<span class="kd">const</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8080</span><span class="p">;</span><span class="w"></span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/api/sign-in&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;get QR&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nx">getQR</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">);</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;/api/callback&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;callback&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nx">callback</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">);</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;server running on port 8080&#39;</span><span class="p">);</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>

<span class="c1">// Create a map to store the auth requests and their session IDs</span><span class="w"></span>
<span class="kd">const</span><span class="w"> </span><span class="nx">requestMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p><strong>Sign-in endpoint</strong> </p>
<p>This is the endpoint that the user must interact with when trying to log-in into your platform. The most important part here is the definition of the request that gets presented to the user. </p>
<p><strong><a href="../query-language/">Understand how to design queries</a></strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">GoLang</label><label for="__tabbed_3_2">Javascript</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// GetQR returns auth request</span><span class="w"></span>
<span class="kd">func</span><span class="w"> </span><span class="nx">GetQR</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Audience is verifier id</span><span class="w"></span>
<span class="w">    </span><span class="nx">rURL</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;&lt;YOUR REMOTE HOST&gt;&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nx">sessionID</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="nx">CallbackURL</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;/api/callback&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nx">Audience</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;1125GJqgw6YEsKFwj63GY87MMxPL9kwDKxPUiwMLNZ&quot;</span><span class="w"></span>

<span class="w">    </span><span class="nx">uri</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s%s?sessionId=%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rURL</span><span class="p">,</span><span class="w"> </span><span class="nx">CallbackURL</span><span class="p">,</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">sessionID</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="nx">protocol</span><span class="p">.</span><span class="nx">AuthorizationRequestMessage</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Generate request for basic authentication</span><span class="w"></span>
<span class="w">    </span><span class="nx">request</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">auth</span><span class="p">.</span><span class="nx">CreateAuthorizationRequestWithMessage</span><span class="p">(</span><span class="s">&quot;test flow&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;message to sign&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Audience</span><span class="p">,</span><span class="w"> </span><span class="nx">uri</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="nx">request</span><span class="p">.</span><span class="nx">ID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;7f38a193-0918-4a48-9fac-36adfdb8b542&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nx">request</span><span class="p">.</span><span class="nx">ThreadID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;7f38a193-0918-4a48-9fac-36adfdb8b542&quot;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Add request for a specific proof</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">mtpProofRequest</span><span class="w"> </span><span class="nx">protocol</span><span class="p">.</span><span class="nx">ZeroKnowledgeProofRequest</span><span class="w"></span>
<span class="w">    </span><span class="nx">mtpProofRequest</span><span class="p">.</span><span class="nx">ID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="nx">mtpProofRequest</span><span class="p">.</span><span class="nx">CircuitID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">circuits</span><span class="p">.</span><span class="nx">AtomicQuerySigCircuitID</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nx">mtpProofRequest</span><span class="p">.</span><span class="nx">Rules</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="w"></span>
<span class="w">        </span><span class="s">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">pubsignals</span><span class="p">.</span><span class="nx">Query</span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nx">AllowedIssuers</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;*&quot;</span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="nx">Req</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;birthDay&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="w"></span>
<span class="w">                    </span><span class="s">&quot;$lt&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20000101</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="nx">Schema</span><span class="p">:</span><span class="w"> </span><span class="nx">protocol</span><span class="p">.</span><span class="nx">Schema</span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="nx">URL</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;https://schema.polygonid.com/jsonld/kyc.json-ld&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AgeCredential&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nx">request</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Scope</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Scope</span><span class="p">,</span><span class="w"> </span><span class="nx">mtpProofRequest</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Store auth request in map associated with session ID</span><span class="w"></span>
<span class="w">    </span><span class="nx">requestMap</span><span class="p">[</span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">sessionID</span><span class="p">)]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">request</span><span class="w"></span>

<span class="w">    </span><span class="nx">msgBytes</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"></span>


<span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">msgBytes</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// GetQR returns auth request</span><span class="w"></span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getQR</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Audience is verifier id</span><span class="w"></span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">hostUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&lt;YOUR REMOTE HOST&gt;&#39;</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sessionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">callbackURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;/api/callback&quot;</span><span class="w"></span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">audience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;1125GJqgw6YEsKFwj63GY87MMxPL9kwDKxPUiwMLNZ&quot;</span><span class="w"></span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">hostUrl</span><span class="si">}${</span><span class="nx">callbackURL</span><span class="si">}</span><span class="sb">?sessionId=</span><span class="si">${</span><span class="nx">sessionId</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Generate request for basic authentication</span><span class="w"></span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">auth</span><span class="p">.</span><span class="nx">createAuthorizationRequestWithMessage</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="s1">&#39;test flow&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s1">&#39;message to sign&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nx">audience</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nx">uri</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="nx">request</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;7f38a193-0918-4a48-9fac-36adfdb8b542&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nx">request</span><span class="p">.</span><span class="nx">thid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;7f38a193-0918-4a48-9fac-36adfdb8b542&#39;</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Add request for a specific proof</span><span class="w"></span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">proofRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nx">circuit_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;credentialAtomicQuerySig&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nx">rules</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">allowedIssuers</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="nx">schema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;AgeCredential&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://schema.polygonid.com/jsonld/kyc.json-ld&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="nx">req</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nx">birthDay</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nx">$lt</span><span class="o">:</span><span class="w"> </span><span class="mf">20000101</span><span class="p">,</span><span class="w"> </span><span class="c1">// bithDay field less then 2000/01/01</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">scope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scope</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="w">    </span><span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="nx">scope</span><span class="p">,</span><span class="w"> </span><span class="nx">proofRequest</span><span class="p">];</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Store auth request in map associated with session ID</span><span class="w"></span>
<span class="w">    </span><span class="nx">requestMap</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">sessionId</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span><span class="nx">request</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">200</span><span class="p">).</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</code></pre></div>
</div>
</div>
</div>
<p>Note the auth request doesn't need to include a query for a specific proof (<code>mtpProofRequest</code>). A web application can simply create an authorization request with a message to sign only using the <a href="https://github.com/iden3/js-iden3-auth/blob/develop/src/auth/auth.ts#L29"><code>auth.createAuthorizationRequestWithMessage</code></a> method without appending any Scope to the request body. An even simpler authorization request may also not need any message to sign, in that case you should implement the <a href="https://github.com/iden3/js-iden3-auth/blob/develop/src/auth/auth.ts#L22"><code>auth.createAuthorizationRequest</code></a> authorization method. </p>
</li>
<li>
<p><strong>Callback endpoint</strong></p>
<p>The callback post endpoint receives the JWZ from the identity wallet. The role of the callback endpoint is to execute the verification on the proof and further verification based on its input. The verification is executed inside the <code>verifier.FullVerify</code> function </p>
<blockquote>
<p>To ADD: The identity state <code>contractAddress</code> on polygon mainnet is 0xb8a86e138C3fe64CbCba9731216B1a638EEc55c8. The public verification keys for iden3 circuits generated after the trusted setup can be found <a href="https://github.com/iden3/tutorial-examples/tree/main/verifier-integration/keys">here</a> and must be added to your project inside a folder called <code>keys</code>. Also, don't forget to add the RPC endpoint (such as Alchemy or Infura) inside the <code>ethURL</code> variable!</p>
</blockquote>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">GoLang</label><label for="__tabbed_4_2">Javascript</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// Callback verifies the proof after sign-in callbacks</span><span class="w"></span>
<span class="kd">func</span><span class="w"> </span><span class="nx">Callback</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Get session ID from request</span><span class="w"></span>
<span class="w">    </span><span class="nx">sessionID</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Query</span><span class="p">().</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;sessionId&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="c1">// get JWZ token params from the post request</span><span class="w"></span>
<span class="w">    </span><span class="nx">tokenBytes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Add Polygon RPC node endpoint - needed to read on-chain state</span><span class="w"></span>
<span class="w">    </span><span class="nx">ethURL</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;&lt;RPCNODEURL&gt;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Add identity state contract address</span><span class="w"></span>
<span class="w">    </span><span class="nx">contractAddress</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;0xb8a86e138C3fe64CbCba9731216B1a638EEc55c8&quot;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Locate the directory that contains circuit&#39;s verification keys</span><span class="w"></span>
<span class="w">    </span><span class="nx">keyDIR</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;../keys&quot;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// fetch authRequest from sessionID</span><span class="w"></span>
<span class="w">    </span><span class="nx">authRequest</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">requestMap</span><span class="p">[</span><span class="nx">sessionID</span><span class="p">]</span><span class="w"></span>

<span class="w">    </span><span class="c1">// load the verifcation key</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">verificationKeyloader</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">loaders</span><span class="p">.</span><span class="nx">FSKeyLoader</span><span class="p">{</span><span class="nx">Dir</span><span class="p">:</span><span class="w"> </span><span class="nx">keyDIR</span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="nx">resolver</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">ETHResolver</span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">RPCUrl</span><span class="p">:</span><span class="w">   </span><span class="nx">ethURL</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nx">Contract</span><span class="p">:</span><span class="w"> </span><span class="nx">contractAddress</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// EXECUTE VERIFICATION</span><span class="w"></span>
<span class="w">    </span><span class="nx">verifier</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">auth</span><span class="p">.</span><span class="nx">NewVerifier</span><span class="p">(</span><span class="nx">verificationKeyloader</span><span class="p">,</span><span class="w"> </span><span class="nx">loaders</span><span class="p">.</span><span class="nx">DefaultSchemaLoader</span><span class="p">{</span><span class="nx">IpfsURL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ipfs.io&quot;</span><span class="p">},</span><span class="w"> </span><span class="nx">resolver</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nx">authResponse</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">verifier</span><span class="p">.</span><span class="nx">FullVerify</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Context</span><span class="p">(),</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">tokenBytes</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="nx">authRequest</span><span class="p">.(</span><span class="nx">protocol</span><span class="p">.</span><span class="nx">AuthorizationRequestMessage</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nx">userID</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">authResponse</span><span class="p">.</span><span class="nx">From</span><span class="w"></span>

<span class="w">    </span><span class="nx">messageBytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;User with ID &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">userID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; Successfully authenticated&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">messageBytes</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// Callback verifies the proof after sign-in callbacks</span><span class="w"></span>
<span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">callback</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Get session ID from request</span><span class="w"></span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sessionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">sessionId</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// get JWZ token params from the post request</span><span class="w"></span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">getRawBody</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tokenStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">raw</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">trim</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">// fetch authRequest from sessionID</span><span class="w"></span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">authRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">requestMap</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">sessionId</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Locate the directory that contains circuit&#39;s verification keys</span><span class="w"></span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">verificationKeyloader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">loaders</span><span class="p">.</span><span class="nx">FSKeyLoader</span><span class="p">(</span><span class="s1">&#39;../keys&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sLoader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">loaders</span><span class="p">.</span><span class="nx">UniversalSchemaLoader</span><span class="p">(</span><span class="s1">&#39;ipfs.io&#39;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Add Polygon RPC node endpoint - needed to read on-chain state and identity state contract address</span><span class="w"></span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ethStateResolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">resolver</span><span class="p">.</span><span class="nx">EthStateResolver</span><span class="p">(</span><span class="s1">&#39;&lt;RPCNODEURL&gt;&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0xb8a86e138C3fe64CbCba9731216B1a638EEc55c8&#39;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// EXECUTE VERIFICATION</span><span class="w"></span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">verifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">auth</span><span class="p">.</span><span class="nx">Verifier</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="nx">verificationKeyloader</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nx">sLoader</span><span class="p">,</span><span class="w"> </span><span class="nx">ethStateResolver</span><span class="p">,</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>


<span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">authResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">verifier</span><span class="p">.</span><span class="nx">fullVerify</span><span class="p">(</span><span class="nx">tokenStr</span><span class="p">,</span><span class="w"> </span><span class="nx">authRequest</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">500</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">return</span><span class="w"> </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">200</span><span class="p">).</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;user with ID: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">authResponse</span><span class="p">.</span><span class="kr">from</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; Succesfully authenticated&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</div>
</div>
</div>
</li>
</ol>
<h2 id="verification-procedure">Verification Procedure</h2>
<p>The auth library provides a simple handler to extract all the necessary metadata from the JWZ token and execute all the verifications needed. The verification procedure that is happening behind the scenes involves: </p>
<h3 id="zero-knowledge-proof-verification">Zero Knowledge Proof Verification</h3>
<p>Starting from the circuit specific public verification key, the proof and the public inputs provided by the user inside the JWZ it is possible to verify the proof. In this case the Proof verification involves: </p>
<ul>
<li>Verification of the proof contained in the JWZ signature based on the <a href="../../circuits/main-circuits/#authentication"><code>Auth Circuit</code></a></li>
<li>Verification of the proof contained in the JWZ payload based on the <a href="../../circuits/main-circuits/#credentialatomicquerysig"><code>AtomicQuerySig Circuit</code></a> or <a href="../../circuits/main-circuits/#credentialatomicquerymtp"><code>AtomicQueryMTP</code></a> based on the query.</li>
</ul>
<h3 id="verification-of-on-chain-identity-states">Verification of On-chain Identity States</h3>
<p>Starting from the Identifier of the user, the State is fetched from blockchain and compared to the state provided as input to the proof to check whether the user is actually "owner" of the state used to generate the proof. It's important to note here is that there's no gas cost associated with the verification as the VerifyState method is just reading the identity state of the user on-chain without making any operations/smart contract call. The same verfication is performed for the Issuer Identity State.</p>
<p>In this part, it is also verified that the claim hasn't been revoked by the Issuer.</p>
<h3 id="verification-of-circuit-public-inputs">Verification of Circuit Public Inputs</h3>
<p>This involves a verification based on the public inputs of the circuits used to generate the proof. These must match the rules requested by the verifier inside the auth request. For example the query and the claim schema used by the user to generate the proof must match the auth request:</p>
<ul>
<li>The message signed by the user is the same as the one passed to the user in the auth request</li>
<li>The rules such as the <code>query</code> or the claim <code>schema</code> used as public input for the circuit match the ones included inside the auth request. </li>
</ul>
<p>This "off-circuit" verification is important because a user can potentially modify the query and present a valid proof. A user born the 2000-12-31 shouldn't pass the check. But if they generate a proof using a query input <code>"$lt": 20010101</code>, the verifier would see it as a valid proof. By doing verifying the public inputs of the circuit, the verifier is able to detect the cheat.</p>
<blockquote>
<p>The executable code for this section can be found <a href="https://github.com/0xPolygonID/tutorial-examples/tree/main/verifier-integration">here</a></p>
</blockquote>

              
            </article>
            
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../zk-login-workflow/" class="md-footer__link md-footer__link--prev" aria-label="Previous: ZK login workflow" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              ZK login workflow
            </div>
          </div>
        </a>
      
      
        
        <a href="../demo/" class="md-footer__link md-footer__link--next" aria-label="Next: Demo" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Demo
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
    
  </body>
</html>